angular.module("time").controller("UsersCtrl",["$scope","$http","$routeParams","$location","usSpinnerService",function(n,t,i,r,u){n.search="";n.loaded=!1;n.load=function(){u.spin("spinner");t.get("/Home/GetUsers").then(function(t){n.users={};$.each(t.data,function(t,i){n.users[i.userID]=i});u.stop("spinner");n.loaded=!0;t.status===204&&(toastr.error("Not an Admin."),window.history.back())},function(){u.stop("spinner");toastr.error("Failed to get users.");r.path("/dashboard")});n.saveUser=function(n){t.post("/Home/ChangeUser",n).then(function(){toastr.success("User saved.")},function(n){n.status===500?toastr.error("Failed to save user, query error."):n.status===401?toastr.error("Unauthorized to make changes to this user."):toastr.error("Failed to save user, unknown error.")})}};n.$parent.user&&n.$parent.user!==""?n.$parent.user.type!=="A"?(toastr.error("Not Admin."),r.path("/dashboard")):n.load():t.get("/Home/CheckSession").then(function(t){n.$parent.user=t.data;n.$parent.user.type!=="A"&&(toastr.error("Not Admin."),r.path("/dashboard"));n.$parent.loaded=!0;n.load()},function(){toastr.error("Not logged in.");r.path("/login")})}]);