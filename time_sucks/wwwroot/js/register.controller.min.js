angular.module("time").controller("RegisterCtrl",["$scope","$http","$routeParams","$location","usSpinnerService",function(n,t,i,r,u){n.loaded=!1;n.load=function(){n.user={};n.user.firstName="";n.user.lastName="";n.user.password="";n.user.type="S";n.password="";n.repeatPassword="";n.register=function(){if(n.user.username===""){toastr.error("Please enter a Username");return}if(n.user.displayName===""){toastr.error("Please enter a Display Name");return}if(n.password===""){toastr.error("Please enter a Password");return}if(n.repeatPassword!==n.password){toastr.error("Your passwords don't match.");return}n.user.password=CryptoJS.SHA256(n.password).toString(CryptoJS.enc.Hex);u.spin("spinner");t.post("/Home/RegisterUser",n.user).then(function(n){u.stop("spinner");n.status===204?toastr.error("Username already taken."):(toastr.success("User created."),r.path("/dashboard"))},function(){u.stop("spinner");toastr.error("Error creating user.")})};n.cancel=function(){r.path("/")};n.loaded=!0;$("#username").focus()};u.spin("spinner");t.get("/Home/CheckSession").then(function(t){if(u.stop("spinner"),t.data===""){n.load();return}n.$parent.user=t.data;n.$parent.loaded=!0;n.$parent.user.type==="A"||n.$parent.user.type==="I"?r.path("/courses"):r.path("/dashboard")},function(){u.stop("spinner");n.load()})}]);